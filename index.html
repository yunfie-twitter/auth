```html
<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Miauth モーダルサンプル (MDL版)</title>

<!-- Material Design Lite -->
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<style>
/* モーダル */
.modal-backdrop {
  position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center;
  z-index:1000; visibility:hidden; opacity:0; transition:opacity .18s;
}
.modal-backdrop.show { visibility:visible; opacity:1; }

.modal {
  background:#fff; border-radius:10px; width:min(480px, 92%); padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
#status { margin-top:14px; font-size:13px; color:#666; }

#iframeContainer {
  position:fixed; inset:0; width:100%; height:100%; border:none; display:none;
}
</style>
</head>
<body>

<!-- ログインボタン -->
<button id="openModalBtn" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored">
  Miauthでログイン（モーダル）
</button>

<!-- モーダル -->
<div id="miauthModal" class="modal-backdrop" role="dialog" aria-hidden="true">
  <div class="modal" role="document">
    <h4>Misskeyでログイン</h4>
    <p>アカウントでログインしてアクセスを許可してください。完了するとこのモーダルに戻ります。</p>
    <div>
      <button id="cancelBtn" class="mdl-button mdl-js-button">キャンセル</button>
      <button id="loginBtn" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
        Misskeyでログイン
      </button>
    </div>
    <div id="status">未ログイン</div>
  </div>
</div>

<!-- iframe (ログイン後にフルスクリーンで表示) -->
<iframe id="iframeContainer" src=""></iframe>

<script>
const INSTANCE_URL = 'https://id.noctella.fun';
const CLIENT_ID = '';
const REDIRECT_URI = 'https://yunfie-twitter.github.io/auth/miauth_redirect.html';

const modal = document.getElementById('miauthModal');
const openBtn = document.getElementById('openModalBtn');
const cancelBtn = document.getElementById('cancelBtn');
const loginBtn = document.getElementById('loginBtn');
const status = document.getElementById('status');
const iframe = document.getElementById('iframeContainer');

let popup = null;
let authState = null;

/* --- Cookie 操作 --- */
function setCookie(name, value, days=30) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/`;
}
function getCookie(name) {
  const m = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  return m ? decodeURIComponent(m[2]) : null;
}

/* --- 初期化: Cookieにログイン情報あればiframe表示 --- */
window.addEventListener('DOMContentLoaded', () => {
  const token = getCookie('miauth_access_token');
  if (token) {
    showIframe();
  }
});

/* --- モーダル制御 --- */
function showModal() {
  modal.classList.add('show');
  modal.setAttribute('aria-hidden', 'false');
}
function hideModal() {
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden', 'true');
}

openBtn.addEventListener('click', () => { showModal(); });
cancelBtn.addEventListener('click', () => { hideModal(); });

/* --- state生成 --- */
function makeState() {
  const s = crypto.getRandomValues(new Uint8Array(16));
  return Array.from(s).map(b => b.toString(16).padStart(2,'0')).join('');
}

/* --- Miauthフロー開始 --- */
function startMiauthFlow() {
  authState = makeState();
  const params = new URLSearchParams({
    client_id: CLIENT_ID,
    redirect_uri: REDIRECT_URI,
    response_type: 'token',
    state: authState,
  });
  const authUrl = `${INSTANCE_URL.replace(/\/$/, '')}/miauth/authorize?${params.toString()}`;

  const w = 520, h = 720;
  const left = (screen.width / 2) - (w / 2);
  const top = (screen.height / 2) - (h / 2);
  popup = window.open(authUrl, 'miauth_popup', `width=${w},height=${h},left=${left},top=${top}`);
  if (!popup) {
    status.textContent = 'ポップアップブロックされています。';
    return;
  }
  status.textContent = '認証中...';
  popup.focus();
}

/* --- iframe表示 --- */
function showIframe() {
  openBtn.style.display = 'none';
  modal.style.display = 'none';
  iframe.style.display = 'block';
  iframe.src = INSTANCE_URL; // ログイン後に表示するページ（例：タイムライン）
}

/* --- デバッグモード: Shiftキー押しながらログインでバイパス --- */
loginBtn.addEventListener('click', (ev) => {
  if (ev.shiftKey) {
    // 強制バイパス
    setCookie('miauth_access_token', 'debug_dummy_token');
    status.textContent = 'デバッグモード: バイパスログイン成功';
    hideModal();
    showIframe();
    return;
  }
  startMiauthFlow();
});

/* --- 認証完了受信 --- */
window.addEventListener('message', (ev) => {
  try {
    const data = ev.data;
    if (!data || data.type !== 'miauth_result') return;
    if (data.state !== authState) {
      status.textContent = 'state不一致';
      return;
    }
    if (data.error) {
      status.textContent = 'エラー: ' + data.error;
    } else {
      const token = data.access_token || data.token || null;
      if (token) {
        setCookie('miauth_access_token', token);
        status.textContent = 'ログイン成功';
        hideModal();
        showIframe();
      }
    }
    if (popup && !popup.closed) popup.close();
  } catch (e) {
    console.error(e);
  }
});
</script>
</body>
</html>
```
